name: Contrast Security
run-name: Contrast Security
on: pull_request

jobs:
  build_and_scan:
    permissions:
      actions: read 
      contents: read 
      security-events: write 
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: remove properties template
      run: rm $GITHUB_WORKSPACE/src/main/resources/application_example.properties 

    - name: rename config file 
      run: cp $GITHUB_WORKSPACE/src/main/resources/application.properties.j2 $GITHUB_WORKSPACE/src/main/resources/application.properties 

    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'adopt'

    - name: Build with Maven
      run: mvn package -DskipTests

    - name: Rename Artifact 
      run: cp $GITHUB_WORKSPACE/target/Bento-0.0.1.war $GITHUB_WORKSPACE/target/ROOT.war

    - name: Verify Build Exists 
      run: cd $GITHUB_WORKSPACE/target/ && ls

    # - name: Contrast Scan Action
    #   uses: Contrast-Security-OSS/contrastscan-action@v2.0.3
    #   with:
    #     artifact: mypath/target/myartifact.jar
    #     apiKey: ${{ secrets.CONTRAST_API_KEY }}
    #     orgId: ${{ secrets.CONTRAST_ORGANIZATION_ID }}
    #     authHeader: ${{ secrets.CONTRAST_AUTH_HEADER }}
    #     severity: high
    #     fail: true
    # # To list vulnerabilities in the GitHub Security Tab of the repo include GitHub upload-sarif action
    # # The value of `sarif_file` must be `results.sarif` 
    # - name: Upload SARIF file
    #   uses: github/codeql-action/upload-sarif@v2
    #   with:
    #     sarif_file: results.sarif